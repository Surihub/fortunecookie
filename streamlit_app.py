import streamlit as st
import pandas as pd
import random
import time
from openai import OpenAI

st.title("ğŸ¥  í¬ì¶˜ì¿ í‚¤ í•˜ë‚˜ ë¨¹ì–´ë³´ì„¸ìš”!")
st.success(
    "ì‹œí—˜ ê¸°ê°„ ì§€ì¹œ ì—¬ëŸ¬ë¶„ì„ ìœ„í•´ ì„ ìƒë‹˜ì´ í¬ì¶˜ì¿ í‚¤ë¥¼ ì¤€ë¹„í–ˆì–´ìš”. **by ì—¬ëŸ¬ë¶„ì˜ ë‹´ì„ìŒ¤**"
)

st.subheader("í¬ì¶˜ì¿ í‚¤ ì—´ì–´ë³´ê¸°")

# ê¸°ë¶„ ì„ íƒ ì˜ì—­
mood_placeholder = st.empty()
mood = mood_placeholder.radio(
    "ì§€ê¸ˆ ê¸°ë¶„ì´ ì–´ë–¤ê°€ìš”?",
    ("ğŸ˜ìì‹ ê° ë¿œë¿œ!", "ğŸ˜±ë¶ˆì•ˆí•´ìš”...", "ğŸ˜³ê¸´ì¥ë¼ìš”!", "ğŸ« ì•„ë¬´ ìƒê° ì—†ì–´ìš”")
)

# í¬ì¶˜ì¿ í‚¤ ì—´ê¸° ë²„íŠ¼
open_cookie = st.button("í¬ì¶˜ì¿ í‚¤ í™•ì¸í•˜ê¸°")

# ë²„íŠ¼ í´ë¦­ ì‹œ ë§ì¶¤í˜• ë¬¸êµ¬ ìƒì„±
if open_cookie:
    # ê¸°ë¶„ ì„ íƒ ë¼ë””ì˜¤ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
    mood_placeholder.empty()

    # ì´ë¯¸ì§€ì™€ "ì ì‹œë§Œ ê¸°ë‹¤ë¦¬ì„¸ìš”..." ë¬¸êµ¬ë¥¼ í‘œì‹œí•  ê³µê°„ ì˜ˆì•½
    placeholder = st.empty()

    # ì´ë¯¸ì§€ì™€ ë¬¸êµ¬ë¥¼ í‘œì‹œ
    with placeholder.container():
        st.image("https://media0.giphy.com/media/gj6CShIcK24SnOWi40/giphy.gif?cid=6c09b952tdfy8qpe35xjzeora63k8ppdot47bgnxd4nusv2y&ep=v1_gifs_search&rid=giphy.gif&ct=g", width=250)
        st.write("í¬ì¶˜ì¿ í‚¤ë¥¼ ì—¬ëŠ” ì¤‘ ì…ë‹ˆë‹¤.... ")

    # 3ì´ˆ ë™ì•ˆ ëŒ€ê¸°
    time.sleep(1)

    # OpenAI API í”„ë¡¬í”„íŠ¸
    prompt = f"ì˜¤ëŠ˜ ëª¨ì˜ê³ ì‚¬ë¥¼ ë³´ëŠ” í•™ìƒë“¤ì—ê²Œ í˜ì„ ì¤„ ìˆ˜ ìˆëŠ” ê°ë™ì ì¸ ì‘ì›ì„ í•´ì¤˜. í¸ì•ˆí•œ ë§ˆìŒìœ¼ë¡œ ë³´ë˜ ê·¸ë˜ë„ ê¸´ì¥ì„ ë„ˆë¬´ ì•ˆí•˜ì§„ ë§ê³  ëê¹Œì§€ ì—´ì‹¬íˆ í’€ê³  ìµœì„ ì„ ë‹¤ í•  ìˆ˜ ìˆë„ë¡! í•™ìƒë“¤ì˜ ê¸°ë¶„ì€ '{mood}'ì´ë¯€ë¡œ ì´ ê¸°ë¶„ì„ ê³ ë ¤í•´ì„œ ê·¸ì— ì ì ˆí•œ ì‘ì›ì„ í•´ì¤˜ì•¼í•´. ì„¸ ë¬¸ì¥ìœ¼ë¡œ ë§í•´ì£¼ê³  ì²« ë¬¸ì¥ì€ ê³µê°ìœ¼ë¡œ ì‹œì‘í•´. í•™ìƒì˜ ë¬´ë“œë¥¼ í•œë²ˆ ë” ì–˜ê¸°í•´ì£¼ëŠ”ê±°ì•¼. ì˜ˆë¥¼ ë“¤ì–´ ì§€ê¸ˆ ê¸´ì¥ë˜ëŠ”êµ¬ë‚˜! ì´ëŸ° ì‹ìœ¼ë¡œ.. ê·¸ë¦¬ê³  ë§íˆ¬ëŠ” í•™ìƒë“¤ì—ê²Œ í•˜ëŠ” ë§ì´ë‹ˆê¹Œ ê·¹ì¡´ì¹­ì€ ì•„ë‹ˆì–´ë„ ì¡´ëŒ€ë¥¼ í•´ì¤˜. ê·¸ë¦¬ê³  ëª¨ì˜ê³ ì‚¬ ë³¼ ë•Œ ë„ì›€ì´ ë˜ëŠ” ë§ì„ í•´ì¤˜. ì§„ì‹¬ì´ ë‹´ê¸´ ì‘ì›ì„!"

    client = OpenAI(api_key=st.secrets.OpenAI.apikey)

    # OpenAI API í˜¸ì¶œí•˜ì—¬ ë¬¸êµ¬ ìƒì„±
    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[
            {
            "role": "system",
            "content": [
                {
                "type": "text",
                "text": prompt,
                }
            ]
            }
        ],
        temperature=1,
        max_tokens=150,
        top_p=1,
        frequency_penalty=0,
        presence_penalty=0,
        response_format={
            "type": "text"
        }
        )
    

    # ìƒì„±ëœ ë¬¸êµ¬ ì¶”ì¶œ
    fortune = response.choices[0].message.content

    # ì´ë¯¸ì§€ë¥¼ ì œê±°í•˜ê³  ë§ì¶¤í˜• ë©”ì‹œì§€ í‘œì‹œ
    placeholder.empty()  # ì´ë¯¸ì§€ì™€ ë¬¸êµ¬ë¥¼ ì œê±°
    st.balloons()
    st.warning(f"ì˜¤ëŠ˜ì˜ ìš´ì„¸: **{fortune}** *generated by GPT & ìˆ©ìŒ¤*", icon="ğŸ”®")